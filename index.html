<!DOCTYPE html>
<html lang="en">
<head>
    <title>Shower Presentation Engine</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="node_modules/@shower/ribbon/styles/styles.css">
    <style>
        .shower {
            --slide-ratio: calc(16 / 9);
        }
        .center {
            text-align: center;
        }
        .margin0 {
            margin: 0 !important;
        }
    </style>
</head>
<body class="shower list">

    <header class="caption">
        <h1>Сила iframe</h1>
        <p>Кузнецов Андрей / РБС</p>
    </header>

    <section class="slide" id="cover">
        <h2>Сила iframe</h2>
        <p>Швейцарский нож в руках фронтендера</p>
        <p class="copyright_cover">Кузнецов Андрей, </br>
            <a href="https://rbs-payments.ru">РБС</a>, Frontend Lead</p>
        <figure>
            <figcaption class="copyright right white">
                <a href="https://ilovedraw.com">Kuznetsov Andrey</a>
            </figcaption>
        </figure>
        <style>
            #cover h2 {
                margin: 30px 0 0;
                color: black;
                text-align: center;
                font-size: 70px;
            }

            #cover .copyright_cover {
                position: absolute;
                right: 70px;
                bottom: 50px;
                text-align: right;
            }

            #cover p {
                margin: 10px 0 0;
                text-align: center;
                color: black;
                font-style: italic;
                font-size: 20px;
            }

            #cover a {
                text-decoration: none;
                background: none;
            }

            #cover p a {
                color: black;
            }

            #cover {
                background-image: url('pictures/slide1/hole.svg');
                background-repeat: no-repeat;
                background-size: contain;
            }
        </style>
    </section>

    <section class="slide" id="about">
        <h2>Кто я и чем занимаюсь</h2>
        <ol>
            <li>Верстал с 2005 года</li>
            <li>До 2012 года Flasher-фрилансер <img src="pictures/slide2/flash.png" width="30" alt="" class="icon_flash"></img></li>
            <li>С 2012 ушел в frontend разработку</li>
            <li>Последние 3 года Frontend Lead в компании "Рунет Бизнес Системы"</li>
        </ol>


        <style>
            #about .icon_flash {
                position: relative;
                top: 6px;
            }
        </style>
    </section>

    <section class="slide" id="about_company">
        <h2>Пару слов о компании</h2>
        <ol>
            <li>Сервис в области электронной коммерции</li>
            <li>White Label решения</li>
            <li>Высокие требования к качеству и безопасности функционала</li>
        </ol>
        <img src="pictures/slide2/P6120241gccr.jpg" alt="" class="photo_rbs">

        <img src="pictures/slide2/logo_color.svg" alt="" class="logo_rbs">

        <style>
            #about_company .logo_rbs {
                position: absolute;
                right: 50px;
                bottom: 50px;
                width: 200px;
            }
            #about_company .photo_rbs {
                position: absolute;
                left: 100px;
                bottom: 30px;
                width: 370px;
            }
        </style>
    </section>

    <section class="slide" id="about_iframe1">
        <h2>История iFrame</h2>
        <ul>
            <li>Добавлен в 1997 году в HTML 4.01 Microsoft Internet Explorer</li>
            <li>Загружает в область заданных размеров любые другие независимые документы</li>
            <li>Ранее был слабозащищен, поэтому имеет плохую репутацию</li>
            <li>Авторы спецификаций и разработчики браузеров исправили это</li>
        </ul>
    </section>

    <section class="slide" id="about_iframe_">
        <div class="center">
            <img src="pictures/slide3/menu.jpg" alt="" width="300px"/>
        </div>

    </section>

    <section class="slide" id="about_iframe1">
        <h2>Вспомним прошлое. 2005</h2>
        <img src="pictures/slide3/2006.png" alt="" height="70%"/>
    </section>

    <section class="slide" id="about_iframe2">
        <h2>Кратко об iFrame</h2>
        <img src="pictures/slide3/schema.png" width="95%"/>
    </section>


    <section class="slide">
        <h2>Итого на 2020 год</h2>
        <ul>
            <li>Полностью изолирован от родительского документа</li>
            <li class="next">Свой собственный объект window</li>
            <li class="next">Не показывает изменение урла для родителя (если разные домены)</li>
            <li class="next">Но он всё также может <s>сломать страницу</s> мешать пользователю</li>
        </ul>
    </section>

    <section class="slide" id="sandbox">
        <h2>Sandbox</h2>
<pre style="color:#000000;background:#ffffff;">
<code>
<span style="color:#a65700; ">&lt;</span><span style="color:#800000; font-weight:bold; ">iframe</span><span style="color:#274796; "> </span><span style="color:#074726; ">src</span><span style="color:#808030; ">=</span><span style="color:#0000e6; ">"..."</span><span style="color:#274796; "> </span><span style="color:#074726; ">sandbox</span><span style="color:#808030; ">=</span><span style="color:#0000e6; ">"значение"</span><span style="color:#274796; "> </span><span style="color:#a65700; ">/&gt;</span>
</code>
</pre>
        <table>
            <tr>
                <th scope="col">Значение</th>
                <th>Описание</th>
            </tr>
            <tr>
                <th scope="row">(пустое значение)</th>
                <td>Включить все ограничения</td>
            </tr>
            <tr>
                <th scope="row">allow-forms</th>
                <td>Разрешить отправку данных форм</td>
            </tr>
            <tr>
                <th scope="row">allow-pointer-lock</th>
                <td>Разрешить использование Pointer Lock API (захват движения мыши)</td>
            </tr>
            <tr>
                <th scope="row">allow-popups</th>
                <td>Разрешить всплывающие окна (window.open(), target=”_blank”, и др.)</td>
            </tr>
            <tr>
                <th scope="row">allow-same-origin</th>
                <td>Разрешить воспринимать контент фрейма, как контент из того же источника</td>
            </tr>
            <tr>
                <th scope="row">allow-scripts</th>
                <td>Разрешить исполнение скриптов</td>
            </tr>
            <tr>
                <th scope="row">allow-top-navigation</th>
                <td>Разрешить топ навигацию (родителя)</td>
            </tr>
        </table>
        <style>
            table {
                font-size: 0.7em;
            }
            #sandbox pre code {
                line-height: 1;
            }
        </style>
    </section>

    <section class="slide" id="clickjacking_demo">
        <h2>Атака типа clickjacking</h2>
        <a class="button" href="#">Вы выиграли! <br/> Жмакай!</a>
        <iframe src="https://blog.codepen.io/radio/" width="100%" height="400px"></iframe>
        <img src="pictures/slide_clickjacking/agutin.jpg"  class="agutin"/>
        <style>
            #clickjacking_demo .button {
                background-color: black;
                color: #fff;
                display: inline-block;
                padding: 0px;
                border-radius: 10px;
                position: absolute;
                font-size: 14px;
                z-index: 10;
                top: 226px;
                left: 336px;
                width: 114px;
                text-align: center;
            }
            #clickjacking_demo .button:hover {
                cursor: pointer;
            }
            #clickjacking_demo iframe {
                z-index: 999;
                top: -255px;
                position: relative;
                opacity: 0;
            }
            #clickjacking_demo .agutin {
                right: 100px;
                position: absolute;
                bottom: 40px;
                height: 370px;
            }
        </style>
    </section>

    <section class="slide" id="clickjacking_demo2">
        <h2>Атака типа clickjacking</h2>
        <a class="button" href="#">Вы выиграли! <br/> Жмакай!</a>

        <iframe src="https://blog.codepen.io/radio/" width="100%" height="400px"></iframe>
        <style>
            #clickjacking_demo2 .button {
                background-color: black;
                color: #fff;
                display: inline-block;
                padding: 0px;
                border-radius: 10px;
                position: absolute;
                font-size: 14px;
                z-index: 10;
                top: 226px;
                left: 336px;
                width: 114px;
                text-align: center;
            }
            #clickjacking_demo2 .button:hover {
                cursor: pointer;
            }
            #clickjacking_demo2 iframe {
                z-index: 999;
                top: -255px;
                position: relative;
                opacity: 0.5;
            }
        </style>
    </section>

    <section class="slide" id="clickjacking_demo3">
        <h2>Атака типа clickjacking</h2>
        <ul>
            <li>Многие сайты были взломаны подобным способом, включая Twitter, Facebook, Paypal и другие.</li>
            <li class="next">Clickjacking-атака для кликов мыши, а не для клавиатуры</li>
            <li class="next">С одной стороны — эта атака «неглубокая», ведь хакер перехватывает только один клик. Но с другой стороны, если хакер
            знает, что после этого клика появятся другие элементы управления, то он может хитростью заставить пользователя кликнуть
            на них.</li>
        </ul>
    </section>

    <section class="slide" id="clickjacking_demo4">
        <h2>Защита. Заголовок X-Frame-Options</h2>
        <h3 class="margin0">DENY</h3>
        <p>Никогда не показывать страницу внутри фрейма.</p>
        <h3 class="margin0">SAMEORIGIN</h3>
        <p>Разрешить открытие страницы внутри фрейма только в том случае, если родительский документ имеет тот же источник.</p>
        <h3 class="margin0">ALLOW-FROM domain</h3>
        <p>Разрешить открытие страницы внутри фрейма только в том случае, если родительский документ находится на указанном в заголовке домене.</p>

        <style>
            h3, p {
                font-size: 0.8em;
            }
        </style>
    </section>

    <section class="slide" id="clickjacking_div">
        <h2>Защита. Закроемся div</h2>
<pre style='color:#000000;background:#ffffff;'>
<code><span style='color:#a65700; '>&lt;</span><span style='color:#800000; font-weight:bold; '>style</span><span style='color:#a65700; '>></span>
<code>&nbsp;&nbsp;<span style='color:#808030; '>#</span>protector <span style='color:#800080; '>{</span></code>
<code>&nbsp;&nbsp;&nbsp;&nbsp;<span style='color:#bb7977; font-weight:bold; '>height</span><span style='color:#808030; '>:</span> <span style='color:#008c00; '>100</span><span style='color:#006600; '>%</span><span style='color:#800080; '>;</span> <span style='color:#bb7977; font-weight:bold; '>width</span><span style='color:#808030; '>:</span> <span style='color:#008c00; '>100</span><span style='color:#006600; '>%</span><span style='color:#800080; '>;</span> <span style='color:#bb7977; font-weight:bold; '>position</span><span style='color:#808030; '>:</span> <span style='color:#074726; '>absolute</span><span style='color:#800080; '>;</span></code>
<code>&nbsp;&nbsp;&nbsp;&nbsp;<span style='color:#bb7977; font-weight:bold; '>left</span><span style='color:#808030; '>:</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span> <span style='color:#bb7977; font-weight:bold; '>top</span><span style='color:#808030; '>:</span> <span style='color:#008c00; '>0</span><span style='color:#800080; '>;</span> <span style='color:#bb7977; font-weight:bold; '>z-index</span><span style='color:#808030; '>:</span> <span style='color:#008c00; '>99999999</span><span style='color:#800080; '>;</span></code>
<code>&nbsp;&nbsp;<span style='color:#800080; '>}</span></code>
<code><span style='color:#a65700; '>&lt;/</span><span style='color:#800000; font-weight:bold; '>style</span><span style='color:#a65700; '>></span></code>
<code><span style='color:#a65700; '>&lt;</span><span style='color:#800000; font-weight:bold; '>div</span><span style='color:#274796; '> </span><span style='color:#074726; '>id</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"protector"</span><span style='color:#a65700; '>></span></code>
<code>&nbsp;&nbsp;<span style='color:#a65700; '>&lt;</span><span style='color:#800000; font-weight:bold; '>a</span><span style='color:#274796; '> </span><span style='color:#074726; '>href</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"/"</span><span style='color:#274796; '> </span><span style='color:#074726; '>target</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"_blank"</span><span style='color:#a65700; '>></span>Перейти к сайту<span style='color:#a65700; '>&lt;/</span><span style='color:#800000; font-weight:bold; '>a</span><span style='color:#a65700; '>></span></code>
<code><span style='color:#a65700; '>&lt;/</span><span style='color:#800000; font-weight:bold; '>div</span><span style='color:#a65700; '>></span></code>
<code><span style='color:#a65700; '>&lt;</span><span style='color:#800000; font-weight:bold; '>script</span><span style='color:#a65700; '>></span></code>
<code сlass="mark">&nbsp;&nbsp;<span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>top<span style='color:#808030; '>.</span>document<span style='color:#808030; '>.</span>domain <span style='color:#808030; '>==</span> document<span style='color:#808030; '>.</span>domain<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span></code>
<code>&nbsp;&nbsp;&nbsp;&nbsp;protector<span style='color:#808030; '>.</span>remove<span style='color:#808030; '>(</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span></code>
&nbsp;&nbsp;<span style='color:#800080; '>}</span></code>
<code><span style='color:#a65700; '>&lt;/</span><span style='color:#800000; font-weight:bold; '>script</span><span style='color:#a65700; '>></span></code>
</pre>
<style>
    #clickjacking_div pre {
            font-size: 0.5em;
        }
    #clickjacking_div pre code {
        white-space: normal;
    }
</style>
    </section>

    <section class="slide">
        <h2 class="">Ленивая загрузка</h2>
        <div class="center">
            <img src="pictures/slide_lazy/lazy.jpg" alt="" width="600px"/>
        </div>
    </section>

    <section class="slide">
        <h2 class="">Ленивая загрузка</h2>
        <strong>Loading</strong> поддерживает три значения:
        <table>
            <tr>
                <th scope="row">lazy</th>
                <td>является хорошим кандидатом для ленивой загрузки.</td>
            </tr>
            <tr>
                <th scope="row">eager</th>
                <td>не является хорошим кандидатом на ленивую загрузку. Требует загрузки прямо сейчас.</td>
            </tr>
            <tr>
                <th scope="row">auto</th>
                <td>браузер сам определит, стоит ли загружать лениво.</td>
            </tr>
        </table>
        <p class="note">
            *auto в настоящее время является нестандартизированным значением, но по умолчанию именно это значение использует Chrome. Google намерен внести предложение по этому значению в таблицу стандартов.
        </p>
    </section>

    <section class="slide">
        <h2 class="margin0">Можно ли получить доступ к iframe?</h2>
        <h4 class="margin0">При условии, что разные домены</h4>
        <div class="center">
            <img src="pictures/slide_message/1.png" alt="" width="330px"/>
        </div>
    </section>

    <section class="slide">
        <h2 class="shout shrink">Можно, если договориться</h2>
    </section>


    <section class="slide" id="postmessage">
        <h2>PostMessage и "message"</h2>
        <pre>
            <code><mark>otherWindow</mark>.postMessage(<mark>message</mark>, <mark>targetOrigin</mark>);</code>
        </pre>
        <div class="content">
            <div class="next">
                <strong>otherWindow</strong><br>
                Ссылка на другое окно. Для iframe это parent
            </div>
            <div class="next">
                <strong>message</strong><br>
                Данные, которые нужно отправить в другое окно.
            </div>
            <div class="next">
                <strong>targetOrigin</strong><br>
                Определяет источник для окна-получателя, только окно с данного источника имеет право получить сообщение.
                <p class="note">Если мы не хотим проверять, то в targetOrigin можно указать *.</p>
            </div>
        </div>
        <style>
            #postmessage .content {
                font-size: 0.8em;
            }
        </style>
    </section>

    <section class="slide" id="postmessage2">
        <h2>Пример. Закинем инфомрацию в iframe</h2>
<pre style='color:#000000;background:#ffffff;'>
<code><span style='color:#a65700; '>&lt;</span><span style='color:#800000; font-weight:bold; '>iframe</span><span style='color:#274796; '> </span><span style='color:#074726; '>src</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"http://example.com"</span><span style='color:#274796; '> </span><span style='color:#074726; '>name</span><span style='color:#808030; '>=</span><span style='color:#0000e6; '>"example"</span><span style='color:#a65700; '>></span></code>
<code>&nbsp;</code>
<code><span style='color:#a65700; '>&lt;</span><span style='color:#800000; font-weight:bold; '>script</span><span style='color:#a65700; '>></span></code>
<code>&nbsp;&nbsp;<span style='color:#800000; font-weight:bold; '>let</span> win <span style='color:#808030; '>=</span> window<span style='color:#808030; '>.</span>frames<span style='color:#808030; '>.</span>example<span style='color:#800080; '>;</span></code>
<code>&nbsp;&nbsp;win<span style='color:#808030; '>.</span>postMessage<span style='color:#808030; '>(</span><span style='color:#800000; '>"</span><span style='color:#0000e6; '>message</span><span style='color:#800000; '>"</span><span style='color:#808030; '>,</span> <span style='color:#800000; '>"</span><span style='color:#0000e6; '>http://example.com</span><span style='color:#800000; '>"</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span></code>
<code><span style='color:#a65700; '>&lt;/</span><span style='color:#800000; font-weight:bold; '>script</span><span style='color:#a65700; '>></span></code>
</pre>
    </section>

<section class="slide" id="postmessage_example">
<h2>Пример. Ловим информацию в iframe</h2>
<pre style='color:#000000;background:#ffffff;'>
<code>window<span style='color:#808030; '>.</span>addEventListener<span style='color:#808030; '>(</span><span style='color:#800000; '>"</span><span style='color:#0000e6; '>message</span><span style='color:#800000; '>"</span><span style='color:#808030; '>,</span> <span style='color:#800000; font-weight:bold; '>function</span><span style='color:#808030; '>(</span>event<span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span></code>
<code>&nbsp;&nbsp;<span style='color:#800000; font-weight:bold; '>if</span> <span style='color:#808030; '>(</span>event<span style='color:#808030; '>.</span>origin <span style='color:#808030; '>!=</span> <span style='color:#800000; '>'</span><span style='color:#0000e6; '>http://ilovedraw.com</span><span style='color:#800000; '>'</span><span style='color:#808030; '>)</span> <span style='color:#800080; '>{</span></code>
<code>&nbsp;&nbsp;&nbsp;&nbsp;<span style='color:#696969; '>// что-то пришло с неизвестного домена. Проигнорируем это</span></code>
<code>&nbsp;&nbsp;&nbsp;&nbsp;<span style='color:#800000; font-weight:bold; '>return</span><span style='color:#800080; '>;</span></code>
<code>&nbsp;&nbsp;<span style='color:#800080; '>}</span></code>
<code>&nbsp;&nbsp;<span style='color:#800000; font-weight:bold; '>alert</span><span style='color:#808030; '>(</span> <span style='color:#800000; '>"</span><span style='color:#0000e6; '>received: </span><span style='color:#800000; '>"</span> <span style='color:#808030; '>+</span> event<span style='color:#808030; '>.</span>data <span style='color:#808030; '>)</span><span style='color:#800080; '>;</span></code>
<code>&nbsp;&nbsp;<span style='color:#696969; '>// can message back using event.source.postMessage(...)</span></code>
<code><span style='color:#800080; '>}</span><span style='color:#808030; '>)</span><span style='color:#800080; '>;</span></code>
</pre>
<style>
    #postmessage_example code {
        font-size: 0.8em;
    }
</style>
</section>

<section class="slide">
    <h2>Тут будет демка</h2>
    <p>// TODO</p>
</section>

<section class="slide">
    <h2>Сила iframe 🤟🏻</h2>
    <ul>
        <li>Вам требуется создать виджет для встраивания на другие сайты?</li>
        <li>Это может быть от прогноза погоды до покупки авиа-билетов</li>
        <li>Все бы ничего, но кроссдоменные запросы...</li>
    </ul>
</section>

<section class="slide">
    <div class="center">
        <img src="pictures/slide_rbs/gate.jpg" alt="" height="480px"/>
    </div>
</section>


<section class="slide">
    <h2>Порталы</h2>
    <p>// TODO</p>
</section>

    <section class="slide">
        <h2>Demo!</h2>
        <portal src="https://securepayments.sberbank.ru/mportal3" id="portal"></portal>
        <script>
            const portal = document.getElementById('portal');
            portal.addEventListener('click', evt => {
                // Animate the portal once user interacts
                portal.classList.add('portal-transition');
                portal.classList.add('portal-reveal');
            });
            portal.addEventListener('transitionend', evt => {
                if (evt.propertyName == 'transform') {
                    // Activate the portal once the transition has completed
                    portal.activate();
                }
            });
        </script>
        <style>
            portal {
                position:fixed;
                width: 100%;
                height: 100%;
                opacity: 0;
                box-shadow: 0 0 20px 10px #999;
                transform: scale(0.4);
                transform-origin: bottom left;
                bottom: 20px;
                left: 20px;
                animation-name: fade-in;
                animation-duration: 1s;
                animation-delay: 2s;
                animation-fill-mode:forwards;
            }
            .portal-transition {
                transition: transform 0.4s;
            }
            @media (prefers-reduced-motion: reduce) {
                .portal-transition {
                    transition: transform 0.001s;
                }
            }
            .portal-reveal {
                transform: scale(1.0) translateX(-20px) translateY(20px);
            }
            @keyframes fade-in {
                0%   { opacity: 0; }
                100% { opacity: 1; }
            }
        </style>
    </section>

    <section class="slide" id="final">
        <h2 class="margin0">Спасибо за внимание!</h2>
        <div class="col_left">
            <img src="pictures/final/qr-code.svg" width="100%" alt="" />
        </div>
        <div class="col_right">
            <ul>
                <li>Instagram: <a href="https://instagram.com/chak.andrey">chak.andrey</a></li>
                <li>Telegram: <a href="https://t.me/and_kuznetsov">and_kuznetsov</a></li>
                <li>Facebook: <a href="https://www.facebook.com/and.kuznetsov/">and.kuznetsov</a></li>
            </ul>
        </div>


        <style>
            #final .col_left {
                float: left;
                width: 30%;
            }

            #final li {
                padding-left: 40px;
            }

            #final ul {
                margin-top: 50px;
            }

            #final ul li:before {
                content: ""
            }

            #final .col_right {
                float: left;
                width: 70%;
            }
        </style>
    </section>

    <footer class="badge">
        <a href="https://github.com/shower/shower">Fork me on GitHub</a>
    </footer>

    <div class="progress"></div>

    <script src="node_modules/@shower/core/dist/shower.js"></script>
    <script src="modules/portals.js"></script>
    <!-- Copyright © 3000 Yours Truly, Famous Inc. -->
</body>
</html>
